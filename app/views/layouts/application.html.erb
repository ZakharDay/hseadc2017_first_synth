<!DOCTYPE html>
<html>
  <head>
    <title>Hseadc2017Thereminvox</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%#= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
    <%#= javascript_pack_tag 'thereminvox' %>
    <%#= javascript_pack_tag 'synth' %>
    <%#= javascript_pack_tag 'performance' %>
    <%#= javascript_pack_tag 'exhibition' %>
    <%#= javascript_pack_tag 'room1' %>
    <%#= javascript_pack_tag 'room2' %>
    <%= javascript_pack_tag 'room3' %>

    <script type="text/javascript">
      var c1 = 0
      var c2 = 0
      var c3 = 0

      function readResistance() {
        $.ajax({
          url: "http://localhost:3000/serial_port/read",
          dataType: "json"
        }).done(function(data) {
          console.log("success", data)
          //let d = JSON.parse(data)
          document.getElementById("serialPort").setAttribute("data-resistance", data.measurment)
        }).fail(function() {
          console.log("error")
        }).always(function() {
          // console.log("complete")
        })

        // var r1 = getResistanceFromDOM(1)
        // var r2 = getResistanceFromDOM(2)
        // var r3 = getResistanceFromDOM(3)

        // changeRectangleCSS(r1, r2, r3)

        // $('body').append("<div>" +  + "</div>")

        // console.log(r1, r2, r3)

        setTimeout(function () { readResistance() }, 50)
      }

      function getResistanceFromDOM(position) {
        // console.log($('div'))
        // console.log($('div')[position])
        return $("div:nth-child(" + position + ")").html()
      }

      $(function() {
        console.log("DOM Ready")

        if ($("#serialPort").length) {
          console.log("True")
          readResistance()
        }
      })
    </script>
  </head>

  <body>
    <%= yield %>
  </body>
</html>
